<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  
  
  <title>Java8新特性（四）：新的时间和日期API-梁波的博客|Java|SpringBoot|Golang|Kubernetes|微服务|云原生</title>
  <meta property="og:title" content="Java8新特性（四）：新的时间和日期API" />
  <meta name="twitter:title" content="Java8新特性（四）：新的时间和日期API" />
  
  <meta name="description" content="Java 8另一个新增的重要特性就是引入了新的时间和日期API，它们被包含在java.time包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。">
  <meta property="og:description" content="Java 8另一个新增的重要特性就是引入了新的时间和日期API，它们被包含在java.time包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。">
  <meta name="twitter:description" content="Java 8另一个新增的重要特性就是引入了新的时间和日期API，它们被包含在java.time包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。">
  <meta name="author" content="{Description { .Site.Author.name }}"/>
  <link href='http://flygopher.top/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="http://flygopher.top/img/avatar.jpg" />
  <meta name="twitter:image" content="http://flygopher.top/img/avatar.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://flygopher.top/post/java8-new-date-api/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="梁波的技术博客" />
  
  <meta name="generator" content="Hugo 0.58.3" />
  <link rel="canonical" href="http://flygopher.top/post/java8-new-date-api/" />
  <link rel="alternate" href="http://flygopher.top/index.xml" type="application/rss+xml" title="梁波的技术博客"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css"
        integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.5.0/css/fontawesome.min.css"
        integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  <link rel="stylesheet" href='http://flygopher.top/css/bundle.min.40346b24cc8f36f9e5e3351d62a303e74158b59c2c3c0ba141d1969901b1e4f7.css' integrity='sha256-QDRrJMyPNvnl4zUdYqMD50FYtZwsPAuhQdGWmQGx5Pc='>
  -->














  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-158970182-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://flygopher.top/" title="梁波的技术博客">

        梁波的技术博客
      </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="首页" href="http://flygopher.top/">首页</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">文章分类</a>
              <div class="navlinks-children">
                
                  <a href="http://flygopher.top/archives">Archive</a>
                
                  <a href="http://flygopher.top/categories">Categories</a>
                
                  <a href="http://flygopher.top/tags">tags</a>
                
                  <a href="http://flygopher.top/tags/java">java</a>
                
                  <a href="http://flygopher.top/tags/mongo">mongo</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">书籍</a>
              <div class="navlinks-children">
                
                  <a href="https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/">k8s基础知识</a>
                
                  <a href="https://k8s.imroc.io/">Kubernetes实践指南</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="关于" href="http://flygopher.top/page/about/">关于</a>
            </li>
          
        

        

        

        

      </ul>
    </div>

  </div>
</nav>


    
  
  
  




  

  <header class="header-section ">
    

    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Java8新特性（四）：新的时间和日期API</h1>
                
                
                  <span class="post-meta">
  
    发表于 October 6, 2018
  
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
    

  </header>


    



<div class="container" role="main">
  <div class="row">

    
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div>
            
            
            <h5 id="tags" style="margin-top: 30px;">标签:
              
                  <a href="http://flygopher.top/tags/java/">Java</a> &nbsp;
              
            </h5>
            
        </div>
  
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          
            
<aside class="toc">
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#为什么要引入新的日期类型">为什么要引入新的日期类型</a></li>
<li><a href="#新的日期api">新的日期API</a></li>
<li><a href="#java8-日期-时间类">Java8 日期/时间类</a>
<ul>
<li><a href="#localdate-和-localtime"><code>LocalDate</code>和<code>LocalTime</code></a></li>
<li><a href="#localdatetime"><code>LocalDateTime</code></a></li>
<li><a href="#instant"><code>Instant</code></a></li>
<li><a href="#duration"><code>Duration</code></a></li>
<li><a href="#period"><code>Period</code></a></li>
</ul></li>
<li><a href="#日期的操作和格式化">日期的操作和格式化</a>
<ul>
<li><a href="#增加和减少日期"><code>增加和减少日期</code></a></li>
<li><a href="#格式化日期"><code>格式化日期</code></a></li>
</ul></li>
<li><a href="#时区">时区</a></li>
<li><a href="#其他历法">其他历法</a></li>
<li><a href="#spring-boot-时间格式化">Spring Boot 时间格式化</a>
<ul>
<li><a href="#方案一-强烈推荐">方案一（强烈推荐）</a></li>
<li><a href="#方案二-强烈推荐">方案二（强烈推荐）</a></li>
<li><a href="#方案三-可选">方案三（可选）</a></li>
</ul></li>
<li><a href="#最后">最后</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</aside>

          
  
          
          
          
  
          
          
          
  
          
          
          

          <p>Java 8另一个新增的重要特性就是引入了新的时间和日期API，它们被包含在<code>java.time</code>包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。</p>

<h3 id="为什么要引入新的日期类型">为什么要引入新的日期类型</h3>

<p><strong>在 JDK8 中，一个新的重要特性就是引入了全新的时间和日期API，它被收录在 java.time 包中。借助新的时间和日期API可以以更简洁的方法处理时间和日期。</strong></p>

<p><strong>在 JDK8 之前，所有关于时间和日期的API存在以下几个缺陷，也正是这些缺陷，出现了很多第三方的日期处理框架，例如 Joda-Time，date4j等开源项目。但是，Java 需要一套标准的用于处理时间和日期的框架，于是乎在 JDK8 中引入了新的日期API。遵循 JSR-310 规范的实现，而 Joda-Time 框架的作者正是 JSR-310 的规范的倡导者，所以用过 Joda-Time 的对新日期API也不会陌生。</strong></p>

<blockquote>
<p><code>缺陷</code></p>
</blockquote>

<ul>
<li><strong>之前的 java.util.Date 和 java.util.Calendar 类易用性差，不支持时区，且非线程安全的；</strong></li>
<li><strong>日期格式化类 java.text.DateFormat 是一个抽象类，使用时需要先实例化一个 SimpleDateFormat 对象来处理日期格式化，同时 DateFormat 也不是线程安全的，这意味着如果你在多线程程序中调用同一个 DateFormat 对象，会得到意想不到的结果。</strong></li>
<li><strong>对日期的计算方式繁琐，而且容易出错，因为月份是从0开始的，从 Calendar 中获取的月份需要加一才能表示当前月份。</strong></li>
</ul>

<h3 id="新的日期api">新的日期API</h3>

<p>ZoneId: 时区ID，用来确定Instant和LocalDateTime互相转换的规则</p>

<p>Instant: 用来表示时间线上的一个点</p>

<p>LocalDate: 表示没有时区的日期, LocalDate是不可变并且线程安全的</p>

<p>LocalTime: 表示没有时区的时间, LocalTime是不可变并且线程安全的</p>

<p>LocalDateTime: 表示没有时区的日期时间, LocalDateTime是不可变并且线程安全的</p>

<p>Clock: 用于访问当前时刻、日期、时间，用到时区</p>

<p>Duration: 用秒和纳秒表示时间的数量</p>

<h3 id="java8-日期-时间类">Java8 日期/时间类</h3>

<p>Java 8的日期和时间类包含<code>LocalDate</code>、<code>LocalTime</code>、<code>Instant</code>、<code>Duration</code>以及<code>Period</code>，这些类都包含在<code>java.time</code>包中，下面我们看看这些类的用法。</p>

<h4 id="localdate-和-localtime"><code>LocalDate</code>和<code>LocalTime</code></h4>

<p><code>LocalDate</code>类表示一个具体的日期，但不包含具体时间，也不包含时区信息。可以通过<code>LocalDate</code>的静态方法<code>of()</code>创建一个实例，<code>LocalDate</code>也包含一些方法用来获取年份，月份，天，星期几等：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate localDate = LocalDate.of(2017, 1, 4);     // 初始化一个日期：2017-01-04
int year = localDate.getYear();                     // 年份：2017
Month month = localDate.getMonth();                 // 月份：JANUARY
int dayOfMonth = localDate.getDayOfMonth();         // 月份中的第几天：4
DayOfWeek dayOfWeek = localDate.getDayOfWeek();     // 一周的第几天：WEDNESDAY
int length = localDate.lengthOfMonth();             // 月份的天数：31
boolean leapYear = localDate.isLeapYear();          // 是否为闰年：false</pre></div>
<p>也可以调用静态方法<code>now()</code>来获取当前日期：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate now = LocalDate.now();</pre></div>
<p><code>LocalTime</code>和<code>LocalDate</code>类似，他们之间的区别在于<code>LocalDate</code>不包含具体时间，而<code>LocalTime</code>包含具体时间，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalTime localTime = LocalTime.of(17, 23, 52);     // 初始化一个时间：17:23:52
int hour = localTime.getHour();                     // 时：17
int minute = localTime.getMinute();                 // 分：23
int second = localTime.getSecond(); 				// 秒：52</pre></div>
<h4 id="localdatetime"><code>LocalDateTime</code></h4>

<p><code>LocalDateTime</code>类是<code>LocalDate</code>和<code>LocalTime</code>的结合体，可以通过<code>of()</code>方法直接创建，也可以调用<code>LocalDate</code>的<code>atTime()</code>方法或<code>LocalTime</code>的<code>atDate()</code>方法将<code>LocalDate</code>或<code>LocalTime</code>合并成一个<code>LocalDateTime</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDateTime ldt1 = LocalDateTime.of(2017, Month.JANUARY, 4, 17, 23, 52);

LocalDate localDate = LocalDate.of(2017, Month.JANUARY, 4);
LocalTime localTime = LocalTime.of(17, 23, 52);
LocalDateTime ldt2 = localDate.atTime(localTime);</pre></div>
<p><code>LocalDateTime</code>也提供用于向<code>LocalDate</code>和<code>LocalTime</code>的转化：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate date = ldt1.toLocalDate();
LocalTime time = ldt1.toLocalTime();</pre></div>
<h4 id="instant"><code>Instant</code></h4>

<p><code>Instant</code>用于表示一个时间戳，它与我们常使用的<code>System.currentTimeMillis()</code>有些类似，不过<code>Instant</code>可以精确到纳秒（Nano-Second）。</p>

<p><code>System.currentTimeMillis()</code>方法只精确到毫秒（Milli-Second）。</p>

<p>如果查看<code>Instant</code>源码，发现它的内部使用了两个常量，<code>seconds</code>表示从1970-01-01 00:00:00开始到现在的秒数，<code>nanos</code>表示纳秒部分（<code>nanos</code>的值不会超过<code>999,999,999</code>）。</p>

<p><code>Instant</code>除了使用<code>now()</code>方法创建外，还可以通过<code>ofEpochSecond</code>方法创建：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Instant instant = Instant.ofEpochSecond(120, 100000);</pre></div>
<p><code>ofEpochSecond()</code>方法的第一个参数为秒，第二个参数为纳秒，上面的代码表示从1970-01-01 00:00:00开始后两分钟的10万纳秒的时刻，控制台上的输出为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">1970-01-01T00:02:00.000100Z</pre></div>
<h4 id="duration"><code>Duration</code></h4>

<p><code>Duration</code>的内部实现与<code>Instant</code>类似，也是包含两部分：<code>seconds</code>表示秒，<code>nanos</code>表示纳秒。</p>

<p>两者的区别是<code>Instant</code>用于表示一个时间戳（或者说是一个时间点），而<code>Duration</code>表示一个时间段，所以<code>Duration</code>类中不包含<code>now()</code>静态方法。可以通过<code>Duration.between()</code>方法创建<code>Duration</code>对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDateTime from = LocalDateTime.of(2017, Month.JANUARY, 5, 10, 7, 0);    // 2017-01-05 10:07:00
LocalDateTime to = LocalDateTime.of(2017, Month.FEBRUARY, 5, 10, 7, 0);     // 2017-02-05 10:07:00
Duration duration = Duration.between(from, to);     // 表示从 2017-01-05 10:07:00 到 2017-02-05 10:07:00 这段时间

long days = duration.toDays();              // 这段时间的总天数
long hours = duration.toHours();            // 这段时间的小时数
long minutes = duration.toMinutes();        // 这段时间的分钟数
long seconds = duration.getSeconds();       // 这段时间的秒数
long milliSeconds = duration.toMillis();    // 这段时间的毫秒数
long nanoSeconds = duration.toNanos();      // 这段时间的纳秒数</pre></div>
<p><code>Duration</code>对象还可以通过<code>of()</code>方法创建，该方法接受一个时间段长度，和一个时间单位作为参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Duration duration1 = Duration.of(5, ChronoUnit.DAYS);       // 5天
Duration duration2 = Duration.of(1000, ChronoUnit.MILLIS);  // 1000毫秒</pre></div>
<h4 id="period"><code>Period</code></h4>

<p><code>Period</code>在概念上和<code>Duration</code>类似，区别在于<code>Period</code>是以年月日来衡量一个时间段，比如2年3个月6天：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Period period = Period.of(2, 3, 6);</pre></div>
<p><code>Period</code>对象也可以通过<code>between()</code>方法创建，值得注意的是，由于<code>Period</code>是以年月日衡量时间段，所以between()方法只能接收LocalDate类型的参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">// 2017-01-05 到 2017-02-05 这段时间
Period period = Period.between(
                LocalDate.of(2017, 1, 5),
                LocalDate.of(2017, 2, 5));</pre></div>
<h3 id="日期的操作和格式化">日期的操作和格式化</h3>

<h4 id="增加和减少日期"><code>增加和减少日期</code></h4>

<p>Java 8中的日期/时间类都是不可变的，这是为了保证线程安全。当然，新的日期/时间类也提供了方法用于创建对象的可变版本，比如增加一天或者减少一天：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate date = LocalDate.of(2017, 1, 5);          // 2017-01-05

LocalDate date1 = date.withYear(2016);              // 修改为 2016-01-05
LocalDate date2 = date.withMonth(2);                // 修改为 2017-02-05
LocalDate date3 = date.withDayOfMonth(1);           // 修改为 2017-01-01

LocalDate date4 = date.plusYears(1);                // 增加一年 2018-01-05
LocalDate date5 = date.minusMonths(2);              // 减少两个月 2016-11-05
LocalDate date6 = date.plus(5, ChronoUnit.DAYS);    // 增加5天 2017-01-10</pre></div>
<p>上面例子中对于日期的操作比较简单，但是有些时候我们要面临更复杂的时间操作，比如将时间调到下一个工作日，或者是下个月的最后一天，这时候我们可以使用<code>with()</code>方法的另一个重载方法，它接收一个<code>TemporalAdjuster</code>参数，可以使我们更加灵活的调整日期：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate date7 = date.with(nextOrSame(DayOfWeek.SUNDAY));      // 返回下一个距离当前时间最近的星期日
LocalDate date9 = date.with(lastInMonth(DayOfWeek.SATURDAY));   // 返回本月最后一个星期六</pre></div>
<p>要使上面的代码正确编译，你需要使用静态导入<code>TemporalAdjusters</code>对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">import static java.time.temporal.TemporalAdjusters.*;</pre></div>
<p><code>TemporalAdjusters</code>类中包含了很多静态方法可以直接使用，下面的表格列出了一些方法：</p>

<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>dayOfWeekInMonth</code></td>
<td>返回同一个月中每周的第几天</td>
</tr>

<tr>
<td><code>firstDayOfMonth</code></td>
<td>返回当月的第一天</td>
</tr>

<tr>
<td><code>firstDayOfNextMonth</code></td>
<td>返回下月的第一天</td>
</tr>

<tr>
<td><code>firstDayOfNextYear</code></td>
<td>返回下一年的第一天</td>
</tr>

<tr>
<td><code>firstDayOfYear</code></td>
<td>返回本年的第一天</td>
</tr>

<tr>
<td><code>firstInMonth</code></td>
<td>返回同一个月中第一个星期几</td>
</tr>

<tr>
<td><code>lastDayOfMonth</code></td>
<td>返回当月的最后一天</td>
</tr>

<tr>
<td><code>lastDayOfNextMonth</code></td>
<td>返回下月的最后一天</td>
</tr>

<tr>
<td><code>lastDayOfNextYear</code></td>
<td>返回下一年的最后一天</td>
</tr>

<tr>
<td><code>lastDayOfYear</code></td>
<td>返回本年的最后一天</td>
</tr>

<tr>
<td><code>lastInMonth</code></td>
<td>返回同一个月中最后一个星期几</td>
</tr>

<tr>
<td><code>next / previous</code></td>
<td>返回后一个/前一个给定的星期几</td>
</tr>

<tr>
<td><code>nextOrSame / previousOrSame</code></td>
<td>返回后一个/前一个给定的星期几，如果这个值满足条件，直接返回</td>
</tr>
</tbody>
</table>

<p>如果上面表格中列出的方法不能满足你的需求，你还可以创建自定义的<code>TemporalAdjuster</code>接口的实现，<code>TemporalAdjuster</code>也是一个函数式接口，所以我们可以使用Lambda表达式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">@FunctionalInterface
public interface TemporalAdjuster {
    Temporal adjustInto(Temporal temporal);
}</pre></div>
<p>比如给定一个日期，计算该日期的下一个工作日（不包括星期六和星期天）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate date = LocalDate.of(2017, 1, 5);
date.with(temporal -&gt; {
    // 当前日期
    DayOfWeek dayOfWeek = DayOfWeek.of(temporal.get(ChronoField.DAY_OF_WEEK));

    // 正常情况下，每次增加一天
    int dayToAdd = 1;

    // 如果是星期五，增加三天
    if (dayOfWeek == DayOfWeek.FRIDAY) {
        dayToAdd = 3;
    }

    // 如果是星期六，增加两天
    if (dayOfWeek == DayOfWeek.SATURDAY) {
        dayToAdd = 2;
    }

    return temporal.plus(dayToAdd, ChronoUnit.DAYS);
});</pre></div>
<h4 id="格式化日期"><code>格式化日期</code></h4>

<p>新的日期API中提供了一个<code>DateTimeFormatter</code>类用于处理日期格式化操作，它被包含在<code>java.time.format</code>包中，Java 8的日期类有一个<code>format()</code>方法用于将日期格式化为字符串，该方法接收一个<code>DateTimeFormatter</code>类型参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDateTime dateTime = LocalDateTime.now();
String strDate1 = dateTime.format(DateTimeFormatter.BASIC_ISO_DATE);    // 20170105
String strDate2 = dateTime.format(DateTimeFormatter.ISO_LOCAL_DATE);    // 2017-01-05
String strDate3 = dateTime.format(DateTimeFormatter.ISO_LOCAL_TIME);    // 14:20:16.998
String strDate4 = dateTime.format(DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd&#34;));   // 2017-01-05
String strDate5 = dateTime.format(DateTimeFormatter.ofPattern(&#34;今天是：YYYY年 MMMM DD日 E&#34;, Locale.CHINESE)); // 今天是：2017年 一月 05日 星期四</pre></div>
<p>同样，日期类也支持将一个字符串解析成一个日期对象，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">String strDate6 = &#34;2017-01-05&#34;;
String strDate7 = &#34;2017-01-05 12:30:05&#34;;

LocalDate date = LocalDate.parse(strDate6, DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd&#34;));
LocalDateTime dateTime1 = LocalDateTime.parse(strDate7, DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd HH:mm:ss&#34;));</pre></div>
<p>同样，日期类也支持将一个字符串解析成一个日期对象，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">String strDate6 = &#34;2017-01-05&#34;;
String strDate7 = &#34;2017-01-05 12:30:05&#34;;

LocalDate date = LocalDate.parse(strDate6, DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd&#34;));
LocalDateTime dateTime1 = LocalDateTime.parse(strDate7, DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd HH:mm:ss&#34;));</pre></div>
<h3 id="时区">时区</h3>

<p>Java 8中的时区操作被很大程度上简化了，新的时区类<code>java.time.ZoneId</code>是原有的<code>java.util.TimeZone</code>类的替代品。<code>ZoneId</code>对象可以通过<code>ZoneId.of()</code>方法创建，也可以通过<code>ZoneId.systemDefault()</code>获取系统默认时区：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">ZoneId shanghaiZoneId = ZoneId.of(&#34;Asia/Shanghai&#34;);
ZoneId systemZoneId = ZoneId.systemDefault();</pre></div>
<p><code>of()</code>方法接收一个“区域/城市”的字符串作为参数，你可以通过<code>getAvailableZoneIds()</code>方法获取所有合法的“区域/城市”字符串：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Set&lt;String&gt; zoneIds = ZoneId.getAvailableZoneIds();</pre></div>
<p>对于老的时区类<code>TimeZone</code>，Java 8也提供了转化方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">ZoneId oldToNewZoneId = TimeZone.getDefault().toZoneId();</pre></div>
<p>有了<code>ZoneId</code>，我们就可以将一个<code>LocalDate</code>、<code>LocalTime</code>或<code>LocalDateTime</code>对象转化为<code>ZonedDateTime</code>对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDateTime localDateTime = LocalDateTime.now();
ZonedDateTime zonedDateTime = ZonedDateTime.of(localDateTime, shanghaiZoneId);</pre></div>
<p>将<code>zonedDateTime</code>打印到控制台为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">2017-01-05T15:26:56.147+08:00[Asia/Shanghai]</pre></div>
<p><code>ZonedDateTime</code>对象由两部分构成，<code>LocalDateTime</code>和<code>ZoneId</code>，其中<code>2017-01-05T15:26:56.147</code>部分为<code>LocalDateTime</code>，<code>+08:00[Asia/Shanghai]</code>部分为<code>ZoneId</code>。</p>

<p>另一种表示时区的方式是使用<code>ZoneOffset</code>，它是以当前时间和<strong>世界标准时间（UTC）/格林威治时间（GMT）</strong>的偏差来计算，例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">ZoneOffset zoneOffset = ZoneOffset.of(&#34;+09:00&#34;);
LocalDateTime localDateTime = LocalDateTime.now();
OffsetDateTime offsetDateTime = OffsetDateTime.of(localDateTime, zoneOffset);</pre></div>
<h3 id="其他历法">其他历法</h3>

<p>Java中使用的历法是ISO 8601日历系统，它是世界民用历法，也就是我们所说的公历。平年有365天，闰年是366天。闰年的定义是：非世纪年，能被4整除；世纪年能被400整除。为了计算的一致性，公元1年的前一年被当做公元0年，以此类推。</p>

<p>此外Java 8还提供了4套其他历法（很奇怪为什么没有汉族人使用的农历），每套历法都包含一个日期类，分别是：</p>

<ul>
<li><code>ThaiBuddhistDate</code>：泰国佛教历</li>
<li><code>MinguoDate</code>：中华民国历</li>
<li><code>JapaneseDate</code>：日本历</li>
<li><code>HijrahDate</code>：伊斯兰历</li>
</ul>

<p>每个日期类都继承<code>ChronoLocalDate</code>类，所以可以在不知道具体历法的情况下也可以操作。不过这些历法一般不常用，除非是有某些特殊需求情况下才会使用。</p>

<p>这些不同的历法也可以用于向公历转换：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">LocalDate date = LocalDate.now();
JapaneseDate jpDate = JapaneseDate.from(date);</pre></div>
<p>由于它们都继承<code>ChronoLocalDate</code>类，所以在不知道具体历法情况下，可以通过<code>ChronoLocalDate</code>类操作日期：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Chronology jpChronology = Chronology.ofLocale(Locale.JAPANESE);
ChronoLocalDate jpChronoLocalDate = jpChronology.dateNow();</pre></div>
<p>我们在开发过程中应该尽量避免使用<code>ChronoLocalDate</code>，尽量用与历法无关的方式操作时间，因为不同的历法计算日期的方式不一样，比如开发者会在程序中做一些假设，假设一年中有12个月，如果是中国农历中包含了闰月，一年有可能是13个月，但开发者认为是12个月，多出来的一个月属于明年的。再比如假设年份是累加的，过了一年就在原来的年份上加一，但日本天皇在换代之后需要重新纪年，所以过了一年年份可能会从1开始计算。</p>

<p>在实际开发过程中建议使用<code>LocalDate</code>，包括存储、操作、业务规则的解读；除非需要将程序的输入或者输出本地化，这时可以使用<code>ChronoLocalDate</code>类。</p>

<h3 id="spring-boot-时间格式化">Spring Boot 时间格式化</h3>

<p><strong>Spring Boot 提供了 <code>spring.jackson.date-format</code>，奈何它只能格式化<code>java.util.Date</code>。那么解决办法是什么呢？</strong></p>

<h4 id="方案一-强烈推荐">方案一（强烈推荐）</h4>

<p>只需要定义一个配置类，在里面定义两个 <code>Bean</code> 即可完成全局日期格式化处理，这种方式也是本人现在使用的，同时还兼顾了 <code>Date</code> 和 <code>LocalDateTime</code> 并存</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#ff79c6">package</span> me.flygopher.config;

<span style="color:#ff79c6">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;
<span style="color:#ff79c6">import</span> org.springframework.beans.factory.annotation.Value;
<span style="color:#ff79c6">import</span> org.springframework.boot.autoconfigure.jackson.Jackson2ObjectMapperBuilderCustomizer;
<span style="color:#ff79c6">import</span> org.springframework.context.annotation.Bean;
<span style="color:#ff79c6">import</span> org.springframework.context.annotation.Configuration;

<span style="color:#ff79c6">import</span> java.time.LocalDateTime;
<span style="color:#ff79c6">import</span> java.time.format.DateTimeFormatter;

@Configuration
public class LocalDateTimeSerializerConfig {

    @<span style="color:#50fa7b">Value</span>(<span style="color:#f1fa8c">&#34;${spring.jackson.date-format:yyyy-MM-dd HH:mm:ss}&#34;</span>)
    private String pattern;

    @Bean
    public LocalDateTimeSerializer <span style="color:#50fa7b">localDateTimeDeserializer</span>() {
        <span style="color:#ff79c6">return</span> new <span style="color:#50fa7b">LocalDateTimeSerializer</span>(DateTimeFormatter.<span style="color:#50fa7b">ofPattern</span>(pattern));
    }

    @Bean
    public Jackson2ObjectMapperBuilderCustomizer <span style="color:#50fa7b">jackson2ObjectMapperBuilderCustomizer</span>() {
        <span style="color:#ff79c6">return</span> builder <span style="color:#ff79c6">-</span>&gt; builder.<span style="color:#50fa7b">serializerByType</span>(LocalDateTime.class, <span style="color:#50fa7b">localDateTimeDeserializer</span>());
    }
}</pre></div>
<h4 id="方案二-强烈推荐">方案二（强烈推荐）</h4>

<p>有时候，我们对日期格式要做特殊的处理，全局的格式化方式无法满足我们需求是，使用该方案是非常好的选择，通过 <code>@JsonFormat</code> 注解我们可以更为精准的为日期字段格式化，它也是优先级最高的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">public class Order {

    @JsonFormat(pattern = &#34;yyyy-MM-dd&#34;)
    private LocalDateTime payTime;
    // 省略 GET SET ...
}</pre></div>
<h4 id="方案三-可选">方案三（可选）</h4>

<p>其实和第一种类似，只不过第一种的写法更加优雅简洁，如果有多种类型需要做统一格式化处理，这种方案也不是不可以考虑</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#ff79c6">package</span> me.flygopher.config;

<span style="color:#ff79c6">import</span> com.fasterxml.jackson.core.JsonGenerator;
<span style="color:#ff79c6">import</span> com.fasterxml.jackson.core.JsonParser;
<span style="color:#ff79c6">import</span> com.fasterxml.jackson.databind.<span style="color:#ff79c6">*</span>;
<span style="color:#ff79c6">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
<span style="color:#ff79c6">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;
<span style="color:#ff79c6">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;
<span style="color:#ff79c6">import</span> org.springframework.beans.factory.annotation.Value;
<span style="color:#ff79c6">import</span> org.springframework.context.annotation.Bean;
<span style="color:#ff79c6">import</span> org.springframework.context.annotation.Configuration;
<span style="color:#ff79c6">import</span> org.springframework.context.annotation.Primary;

<span style="color:#ff79c6">import</span> java.io.IOException;
<span style="color:#ff79c6">import</span> java.time.LocalDate;
<span style="color:#ff79c6">import</span> java.time.LocalDateTime;

<span style="color:#ff79c6">import</span> static java.time.format.DateTimeFormatter.ofPattern;

@Configuration
public class LocalDateTimeSerializerConfig2 {

    @<span style="color:#50fa7b">Value</span>(<span style="color:#f1fa8c">&#34;${spring.jackson.date-format:yyyy-MM-dd HH:mm:ss}&#34;</span>)
    private String pattern;

    @Bean
    @Primary
    public ObjectMapper <span style="color:#50fa7b">serializingObjectMapper</span>() {
        ObjectMapper objectMapper = new <span style="color:#50fa7b">ObjectMapper</span>();
        JavaTimeModule javaTimeModule = new <span style="color:#50fa7b">JavaTimeModule</span>();
        javaTimeModule.<span style="color:#50fa7b">addSerializer</span>(LocalDateTime.class, new <span style="color:#50fa7b">LocalDateTimeSerializer</span>());
        javaTimeModule.<span style="color:#50fa7b">addDeserializer</span>(LocalDateTime.class, new <span style="color:#50fa7b">LocalDateTimeDeserializer</span>());
        objectMapper.<span style="color:#50fa7b">registerModule</span>(javaTimeModule);
        <span style="color:#ff79c6">return</span> objectMapper;
    }

    public class LocalDateTimeSerializer extends JsonSerializer&lt;LocalDateTime&gt; {
        @Override
        public void <span style="color:#50fa7b">serialize</span>(LocalDateTime value, JsonGenerator gen, SerializerProvider serializers) throws IOException {
            gen.<span style="color:#50fa7b">writeString</span>(value.<span style="color:#50fa7b">format</span>(<span style="color:#50fa7b">ofPattern</span>(pattern)));
        }
    }

    public class LocalDateTimeDeserializer extends JsonDeserializer&lt;LocalDateTime&gt; {
        @Override
        public LocalDateTime <span style="color:#50fa7b">deserialize</span>(JsonParser p, DeserializationContext deserializationContext) throws IOException {
            <span style="color:#ff79c6">return</span> LocalDateTime.<span style="color:#50fa7b">parse</span>(p.<span style="color:#50fa7b">getValueAsString</span>(), <span style="color:#50fa7b">ofPattern</span>(pattern));
        }
    }
}</pre></div>
<h3 id="最后">最后</h3>

<p>要想在JDBC中使用，Java8中的新时间/日期API，必须要求数据库驱动版本不能低于<code>4.2</code>。</p>

<p>直接打开数据库jar，里面有个<code>META-INF/MANIFEST.MF</code>，打开，查看参数<code>Specification-Version</code>的值。</p>

<p>如果你使用的<code>mysql-connector-java</code>版本低于<code>5.1.37</code>，则数据库的驱动版本低于4.2，运行会报错。</p>

          
  
          
            <div class="entry-shang text-center">
    <p>「真诚赞赏，手留余香」</p>
    <button class="zs show-zs btn btn-bred">赞赏</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
    <div class="zs-modal-head">
        <button type="button" class="close">×</button>
        <span class="author"><img src="http://flygopher.top/img/avatar.jpg"/></span>
        <p class="tip"><i></i><span>请我喝杯咖啡？</span></p>
    </div>
    <div class="zs-modal-body">
        <div class="zs-modal-btns">
            <button class="btn btn-blink" data-num="2">2元</button>
            <button class="btn btn-blink" data-num="5">5元</button>
            <button class="btn btn-blink" data-num="10">10元</button>
            <button class="btn btn-blink" data-num="50">50元</button>
            <button class="btn btn-blink" data-num="100">100元</button>
            <button class="btn btn-blink" data-num="1">任意金额</button>
        </div>
        <div class="zs-modal-pay">
            <button class="btn btn-bred" id="pay-text">2元</button>
            <p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
            <img src="http://flygopher.top/img/wechat-2.png" id="pay-image"/>
        </div>
    </div>
    <div class="zs-modal-footer">
        <span class="zs-wechat"><img src="http://flygopher.top/img/wechat-btn.png"/></span>
    </div>
</div>
          
          
            <div class="social-share" data-initialized="true" style="margin-bottom: 20px;margin-top:20px;">
    <center>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
    </center>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

          
        </article>
  
        
          

<h3>相关文章</h3>
<ul style="margin-bottom: 25px;">
    
    <li><a href="http://flygopher.top/post/java8-optional/">Java8新特性（三）：Optional类</a></li>
    
    <li><a href="http://flygopher.top/post/java8-stream/">Java8新特性（二）：Stream流式处理</a></li>
    
    <li><a href="http://flygopher.top/post/java8-lambda/">Java8新特性（一）：Lambda表达式</a></li>
    
    <li><a href="http://flygopher.top/post/java-serialization/">认识Java序列化</a></li>
    
    <li><a href="http://flygopher.top/post/custom-iterm2-zsh/">iTerm2&#43;zsh打造漂亮好用的终端环境</a></li>
    
    <li><a href="http://flygopher.top/post/vagrant-setup-virtual-machine-cluster/">Vagrant搭建虚拟机集群</a></li>
    
    <li><a href="http://flygopher.top/post/restful-api-best-practice/">RESTful API最佳实践的一些理解</a></li>
    
    <li><a href="http://flygopher.top/post/reids-distributed-lock/">Redis实现分布式锁</a></li>
    
    <li><a href="http://flygopher.top/post/http-performance-tool-wrk/">Http性能压测工具 | wrk</a></li>
    
    <li><a href="http://flygopher.top/post/reids-persistence-intro/">Redis持久化介绍</a></li>
    
</ul>

        
  
        
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://flygopher.top/post/java8-optional/" data-toggle="tooltip" data-placement="top" title="Java8新特性（三）：Optional类">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="http://flygopher.top/post/gradle-environment-setup/" data-toggle="tooltip" data-placement="top" title="搭建Gradle开发环境">后一篇 &rarr;</a>
            </li>
          
        </ul>
        
  
        
  
      </div>
    
    
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:bo.liang0212@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://github.com/amuguelove" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          <li>
            <a href="http://flygopher.top/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          &bull;&nbsp;
          &copy;2016-2020

          
            &nbsp;&bull;&nbsp;
            <a href="http://flygopher.top/">梁波的技术博客</a>
            &nbsp;&bull;&nbsp;
            <a href="http://flygopher.top/sitemap.xml">网站地图</a>
            &nbsp;&bull;&nbsp;
            <a href="http://flygopher.top/archives/">归档</a>
          &nbsp; &bull;&nbsp;
          
        </p>
        <p class="text-center text-muted">
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
          <span id="busuanzi_container_site_pv" style="display:none">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          &nbsp;&bull;&nbsp;
          <span id="busuanzi_container_site_uv" style="display:none">
            访客数<span id="busuanzi_value_site_uv"></span>人次
          </span>
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="http://gohugo.io" target="_blank">Hugo v0.58.3</a> 强力驱动 &nbsp;&bull;&nbsp; 主题移植自 <a href="https://github.com/cnych/qikqiak.com" target="_blank">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>


<script src='http://flygopher.top/js/bundle.min.b7dfdd821c9f407aafd1909c145d179393173d1476e753e70269be48968a707d.js' integrity='sha256-t9/dghyfQHqv0ZCcFF0Xk5MXPRR251PnAmm&#43;SJaKcH0='></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158970182-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158970182-1');
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script >
$(document).ready(function() {
  var int = setInterval(fixCount, 50);  
  
  var initPVCount = 0;
  var initUVCount = 0;
  function fixCount() {                   
    if ($("#busuanzi_container_site_pv").css("display") != "none") {
        $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + initPVCount); 
        clearInterval(int); 
    }
    if ($("#busuanzi_container_site_uv").css("display") != "none") {
      $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + initUVCount);
      clearInterval(int); 
    }  
  }           
});
</script>
<script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript">
$('.carousel').slick({
    dots: true,
    arrows: true,
    autoplay: true,
    autoplaySpeed: 4000,
    infinite: true,
    speed: 500,
    fade: true,
    cssEase: 'linear',
    centerMode: true,
    prevArrow: '<button type="button" class="slick-prev"></button>',
    nextArrow: '<button type="button" class="slick-next"></button>',
});
</script>

  </body>
</html>

